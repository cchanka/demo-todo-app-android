# Android
# Build your Android project with Gradle.
# Add steps that test, sign, and distribute the APK, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/android

trigger: 
- develop

pr: none

pool:
  vmImage: 'macOS-10.14'

 - task: Gradle@2
   inputs:
     workingDirectory: ''
     gradleWrapperFile: 'gradlew'
     gradleOptions: '-Xmx3072m'
     javaHomeOption: 'JDKVersion'
     jdkVersionOption: '1.8'
     jdkArchitectureOption: 'x64'
     tasks: 'assembleDebug'
    env:
      MAJOR_VER: $(app_ver_major)
      MINOR_VER: $(app_ver_minor)
      PATCH_VER: $(app_ver_patch)
      VERSION_CODE: $(BUILD_BUILDID)
   displayName: gradlew assembleDebug
  
# # - task: AndroidSigning@3
# #   inputs:
# #     apkFiles: '**/*.apk'
# #     apksignerKeystoreFile: '$(keystorefilename)'
# #     apksignerKeystorePassword: '$(keystorepassword)'
# #     apksignerKeystoreAlias: '$(keyalias)'
# #     apksignerKeyPassword: '$(keypassword)'
# #     zipalign: false

 - task: AppCenterDistribute@3
   inputs:
     serverEndpoint: '$(APPCENTER_SC_NAME)'
     appSlug: '$(APPCENTER_APP_SLUG)'
     appFile: '$(System.DefaultWorkingDirectory)/app/build/outputs/apk/app-prod-debug.apk'
     symbolsOption: 'Android'
     releaseNotesOption: 'input'
     releaseNotesInput: '$(APPCENTER_APP_REL_NOTES)'
     destinationType: 'groups'
     distributionGroupId: '$(APPCENTER_DIST_GROUP_IDS)'

# # - task: CopyFiles@2
# #   inputs:
# #     contents: '**/*.apk'
# #     targetFolder: '$(build.artifactStagingDirectory)'
# #   displayName: Copy .apk files to artifact staging directory

# # - task: PublishBuildArtifacts@1
# #   inputs:
# #     pathToPublish: '$(build.artifactStagingDirectory)'
# #     artifactName: 'drop'
# #     artifactType: 'container'
# #   displayName: Publish artifacts